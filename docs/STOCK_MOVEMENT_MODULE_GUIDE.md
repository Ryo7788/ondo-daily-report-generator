# 个股异动模块生成指南

> 本文档详细说明日报中「第四章：个股异动」模块的数据来源、生成逻辑和质量规范。

---

## 一、模块结构

个股异动模块位于日报第四章，包含以下三个子章节：

```
## 四、个股异动

### 4.1 昨日/上周涨幅榜
### 4.2 昨日/上周跌幅榜
### 4.3 本周重点关注
```

### 输出格式示例

**涨跌幅榜**：
| 股票 | 收盘价 | 涨跌幅 | 关键事件 |
|------|--------|--------|----------|
| METAon (Meta) | $738.31 | +10.38% | 财报超预期，AI广告变现 |
| AAPLon (Apple) | $258.18 | +1.67% | 财报四项历史新高 |

**本周重点关注**：
| 股票 | 事件 | 北京时间 |
|------|------|----------|
| NFLX | Q4财报 | 1/22(三) 06:00 |
| INTC | Q4财报 | 1/24(五) 06:00 |

---

## 二、数据来源

### 2.1 数据源优先级

| 优先级 | 数据源 | 命令/工具 | 获取内容 |
|--------|--------|-----------|----------|
| 1 | Polygon API | `/massive` | 实时价格、涨跌幅、成交量 |
| 2 | Ondo Token List | `/ondo-tokens check` | 标的支持验证 |
| 3 | 热点新闻 | WebSearch / Grok | 驱动因素分析 |
| 4 | FMP API | `/earnings` | 财报日历关联 |
| 5 | AI 分析 | ChatGPT | 深度解读 |

### 2.2 API 命令说明

**获取个股实时行情**：
```bash
/massive AAPL,MSFT,META,TSLA
```
返回：股票代码、最新价格、涨跌幅、成交量、日内高低点

**验证 Ondo 支持**：
```bash
/ondo-tokens check AAPL,MSFT,META,TSLA
```
返回：✅ 已支持 / ❌ 未支持

**获取财报日历**：
```bash
/earnings week
```
返回：本周发布财报的公司列表、时间、预期 EPS

---

## 三、生成流程

### 3.1 流程图

```
┌─────────────────────────────────────────────────────────────────┐
│                      个股异动模块生成流程                         │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│  第一步：数据采集                                                 │
│  ├── /massive 获取个股实时行情（价格、涨跌幅）                     │
│  ├── /earnings week 获取财报日历                                 │
│  └── 热点新闻搜索（WebSearch/Grok）获取驱动因素                   │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│  第二步：筛选排序                                                 │
│  ├── 按涨跌幅绝对值排序                                          │
│  ├── 关联当日热点新闻（财报、政策、重大事件）                      │
│  ├── 筛选与 Ondo 用户相关的标的                                  │
│  └── 识别异动原因（财报驱动/政策驱动/技术面/情绪面）               │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│  第三步：标的验证 ⚠️ 强制步骤                                     │
│  └── /ondo-tokens check 验证所有标的是否在 Ondo 支持范围          │
│      ├── ✅ 通过 → 使用 XXXon 格式标注                           │
│      └── ❌ 未通过 → 标注"非 Ondo 资产，仅作市场参考"              │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│  第四步：内容填充                                                 │
│  ├── 涨幅榜：股票 + 收盘价 + 涨跌幅 + 关键事件                    │
│  ├── 跌幅榜：股票 + 收盘价 + 涨跌幅 + 关键事件                    │
│  └── 重点关注：股票 + 事件类型 + 北京时间                         │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│  第五步：质量验证                                                 │
│  ├── 确认所有价格数据来自 API（非手动输入）                        │
│  ├── 确认所有标的已通过 Ondo 验证                                 │
│  ├── 确认驱动因素有新闻来源支撑                                   │
│  └── 确认时间标注同时包含美东和北京时间                            │
└─────────────────────────────────────────────────────────────────┘
```

### 3.2 详细步骤说明

#### 第一步：数据采集

1. **获取实时行情**
   ```bash
   /massive AAPL,MSFT,META,TSLA,NVDA,GOOGL
   ```
   - 覆盖科技巨头、热门个股
   - 关注涨跌幅超过 ±3% 的异动股

2. **获取财报日历**
   ```bash
   /earnings week
   ```
   - 识别本周发布财报的公司
   - 关联盘前/盘后异动

3. **搜索驱动因素**
   - 使用 Grok 搜索 X/Twitter 热议
   - 使用 WebSearch 搜索权威媒体报道

#### 第二步：筛选排序

**筛选标准**：
| 条件 | 说明 |
|------|------|
| 涨跌幅 ≥ ±3% | 显著异动 |
| 有明确驱动因素 | 财报/政策/重大新闻 |
| Ondo 支持标的优先 | 与用户交易相关 |
| 社区讨论热度高 | 运营价值高 |

**排序规则**：
1. 涨幅榜：按涨幅从高到低
2. 跌幅榜：按跌幅绝对值从高到低
3. 同涨跌幅时，市值大的优先

#### 第三步：标的验证

**强制规则**：
> 所有出现在「个股异动」中的股票/ETF，如未特别标注"非 Ondo 资产"，必须先用 `/ondo-tokens check` 验证后才能使用。

**验证流程**：
```bash
# 批量验证
/ondo-tokens check AAPL,MSFT,META,TSLA,GLD,SLV

# 预期输出
✅ AAPL - 已支持 (AAPLon)
✅ MSFT - 已支持 (MSFTon)
✅ META - 已支持 (METAon)
✅ TSLA - 已支持 (TSLAon)
✅ GLD - 已支持 (GLDon)
✅ SLV - 已支持 (SLVon)
```

**处理未支持标的**：
- 如必须提及（如重要市场参考），添加标注：
  > ⚠️ 非 Ondo 当前支持标的，仅作市场背景参考

#### 第四步：内容填充

**涨跌幅榜格式**：
```markdown
| 股票 | 收盘价 | 涨跌幅 | 关键事件 |
|------|--------|--------|----------|
| METAon (Meta) | $738.31 | +10.38% | 财报超预期，AI广告变现强劲 |
```

**关键事件撰写规范**：
- 简洁：10-20 字
- 明确：说明具体原因
- 有据：必须有新闻来源支撑

#### 第五步：质量验证

**验证清单**：
| 验证项 | 检查内容 |
|--------|----------|
| ✅ 数据准确性 | 价格、涨跌幅与 `/massive` 返回一致 |
| ✅ 标的验证 | 所有标的已通过 `/ondo-tokens check` |
| ✅ 来源标注 | 每条异动有明确的新闻/数据来源 |
| ✅ 时间一致 | 数据日期与日报日期一致 |
| ✅ 格式规范 | 使用 XXXon 格式标注 Ondo 标的 |

---

## 四、驱动因素分类

### 4.1 常见驱动类型

| 类型 | 说明 | 示例 |
|------|------|------|
| 📊 财报驱动 | 季度财报发布 | "Q4财报超预期，EPS beat 8%" |
| 📜 政策驱动 | 政府政策/监管 | "关税政策利好出口" |
| 🔬 产品驱动 | 新产品/技术突破 | "AI芯片发布超预期" |
| 💰 资本驱动 | 收购/回购/分红 | "宣布$100亿回购计划" |
| 📰 新闻驱动 | 重大新闻事件 | "CEO离职消息" |
| 📈 技术驱动 | 技术面突破 | "突破关键阻力位" |
| 🌡️ 情绪驱动 | 市场情绪变化 | "避险情绪升温" |

### 4.2 驱动因素来源要求

| 驱动类型 | 要求来源 |
|----------|----------|
| 财报数据 | 公司 IR、EarningsWhispers、Benzinga |
| 政策事件 | Reuters、AP、官方公告 |
| 产品新闻 | TechCrunch、公司官网 |
| 市场分析 | CNBC、Bloomberg、Yahoo Finance |

---

## 五、实战案例

### 案例：2026-01-30 日报

**输入数据**：
```bash
# 获取实时行情
/massive AAPL,MSFT,META,TSLA

# 返回结果
AAPL: $258.18 (+1.67%)
MSFT: $433.50 (-9.56%)
META: $738.31 (+10.38%)
TSLA: $416.57 (-3.49%)
```

**热点新闻关联**：
- META +10.38%：Q4财报超预期，AI广告变现见效
- AAPL +1.67%：财报四项指标创历史新高，中国+38%
- MSFT -9.56%：AI CapEx $375B 引发 ROI 担忧
- TSLA -3.49%：宣布停产 Model S/X

**标的验证**：
```bash
/ondo-tokens check AAPL,MSFT,META,TSLA
# ✅ 全部通过
```

**最终输出**：

```markdown
### 4.1 昨日收盘亮点 (2026-01-29)

| 股票 | 收盘价 | 涨跌幅 | 关键事件 |
|------|--------|--------|----------|
| METAon (Meta) | $738.31 | +10.38% | 财报超预期，AI广告变现 |
| AAPLon (Apple) | $258.18 | +1.67% | 财报四项历史新高 |
| MSFTon (Microsoft) | $433.50 | -9.56% | CapEx引发AI投资担忧 |
| TSLAon (Tesla) | $416.57 | -3.49% | Model S/X停产 |
```

---

## 六、常见问题

### Q1: 如果 API 返回数据异常怎么办？

**处理流程**：
1. 检查 API Key 是否有效
2. 检查请求频率是否超限
3. 如无法解决，**暂停并询问用户**
4. ⛔ **禁止**使用 WebSearch 替代 API 数据

### Q2: 非 Ondo 标的如何处理？

**两种方式**：
1. **优先替代**：寻找 Ondo 支持的类似标的
2. **标注引用**：添加"非 Ondo 资产，仅作市场参考"

### Q3: 涨跌幅数据与新闻报道不一致？

**处理原则**：
- 以 `/massive` API 返回数据为准
- 新闻可能引用盘中数据或不同时间点
- 统一使用收盘数据

### Q4: 如何确定"关键事件"？

**优先级**：
1. 当日发布的财报
2. 官方公告（收购、回购、产品发布）
3. 政策/监管消息
4. 分析师评级变化
5. 技术面突破

---

## 七、附录

### A. Ondo 支持标的快速验证

```bash
# 科技巨头
/ondo-tokens check AAPL,MSFT,GOOGL,META,AMZN,NVDA,TSLA

# 金融
/ondo-tokens check JPM,BAC,GS,V,MA

# ETF
/ondo-tokens check SPY,QQQ,IWM,GLD,SLV
```

### B. 常用 /massive 命令

```bash
# 单股详情
/massive AAPL

# 批量快照
/massive AAPL,MSFT,META,TSLA

# 历史K线
/massive AAPL bars 2026-01-01

# 最新报价
/massive AAPL quote
```

### C. 相关文档

| 文档 | 路径 | 说明 |
|------|------|------|
| 日报模板 | `ONDO_DAILY_REPORT_TEMPLATE_V2.md` | 完整日报结构 |
| 生成提示词 | `ONDO_DAILY_REPORT_TEMPLATE_PROMPT.txt` | 生成流程规范 |
| API 配置 | `API_KEYS_GUIDE.md` | API Key 配置说明 |
| Massive Skill | `.claude/skills/massive-api/skill.md` | 个股行情获取 |
| Ondo Tokens Skill | `.claude/skills/ondo-tokens/skill.md` | 标的验证 |

---

*最后更新：2026-01-30*
